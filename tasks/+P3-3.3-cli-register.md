# P3-3.3 Implement `vpn-cli register --server=<url>`

## Summary
Client generates key pair, calls server API, stores complete VPN configuration locally.

## Deliverables
- Client: `cmd/vpn-cli/main.go` register command implementation
- HTTP client for server communication
- Stores: client private/public keys, server pubkey, endpoint, assigned IP, timestamps
- Server: `POST /api/register` endpoint (JSON) with complete VPN config response
- Secure config persistence with proper file permissions

## Acceptance Criteria
- [x] Successful registration persists config locally ✅
- [x] Client key pair generation ✅
- [x] Server API communication ✅
- [x] Complete VPN configuration storage ✅
- [x] Duplicate registration prevention ✅
- [x] User-friendly output with emojis and guidance ✅

## Status: **COMPLETED** ✅

### Implementation Details
- **Command**: `vpn-cli register --server=<url>` with required server flag
- **Key Generation**: Uses `internal/wireguard/keys` for secure key pair generation
- **HTTP Communication**: Direct HTTP client with JSON request/response
- **Config Storage**: Integrates with `internal/client/config` for secure persistence
- **Error Handling**: Comprehensive validation and user-friendly error messages
- **Workflow Integration**: Seamless integration with connect/disconnect/status commands

### Registration Flow
1. **Validation**: Check if already registered (prevents duplicates)
2. **Key Generation**: Generate WireGuard client key pair
3. **Server Request**: POST to `/api/register` with client public key
4. **Response Processing**: Parse server public key, endpoint, and assigned IP
5. **Config Storage**: Save complete configuration to `~/.go-wire-vpn/config.json`
6. **User Feedback**: Display registration success and next steps

### API Specification
**Request**:
```json
{
  "clientPublicKey": "base64-encoded-public-key"
}
```

**Response**:
```json
{
  "serverPublicKey": "base64-encoded-server-public-key",
  "serverEndpoint": "localhost:51820",
  "clientIP": "10.0.0.2/32",
  "message": "Registration successful - VPN tunnel established",
  "timestamp": "2025-01-10T15:30:00Z"
}
```

### Example Usage
```bash
# Register with local development server
vpn-cli register --server=http://localhost:8443

# Output:
# 🔐 Client Registration Demo
# Generating client key pair...
# ✅ Client Public Key: k7vHfX4Km9f8d3wq5N8F2g5z7m1P3Q6r9s2B5x8C4A=
# 📡 Registering with server: http://localhost:8443
# ✅ Registration successful - VPN tunnel established
# 📋 Server Details:
#    Public Key: m8wHgY5Lm0g9e4xr6O9G3h6z8n2Q4R7t0u3C6y9D5B=
#    Endpoint: localhost:51820
#    Your VPN IP: 10.0.0.2/32
# 🕒 Timestamp: 2025-01-10T15:30:00Z
# 
# 🎉 Registration complete! Configuration saved securely.
# 💡 Next step: Run 'vpn-cli connect' to establish VPN tunnel
```

### Security Features
- **Secure Key Generation**: Cryptographically secure WireGuard key pairs
- **Config Protection**: File permissions 0600 (Unix) for config privacy
- **Key Validation**: Server-side public key format validation
- **Error Handling**: No sensitive data in error messages or logs

### Files Modified
- `cmd/vpn-cli/main.go` - Register command implementation and HTTP client
- `internal/client/config/config.go` - Used for secure config persistence
- `internal/wireguard/keys/keys.go` - Used for key generation and validation

## Dependencies
- P3-3.1 (CLI Framework) ✅
- P3-3.2 (Client Config Storage) ✅
- P1-1.5 (Minimal Server with /api/register endpoint) ✅

## Integration
- **Completed in**: P3-3.1 (basic implementation) + P3-3.2 (config integration)
- **Enhanced for**: Demo-02 local VPN tunnel demonstration
- **Foundation for**: Remote server deployment and production features

## Estimate
5 days (Completed as part of P3-3.1/P3-3.2)










